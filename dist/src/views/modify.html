<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <!-- FontAwesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
      rel="stylesheet"
    />
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css" />

    <script src="https://unpkg.com/jszip/dist/jszip.min.js"></script>

    <script src="/scripts/docx-preview.min.js"></script>
  </head>

  <body class=" ">
    <div
      id="editableDiv"
      contenteditable="true"
      style="border: 1px solid #ccc; padding: 10px; width: 300px; height: 150px"
    >
      Click here and start typing...
    </div>
    <br />
    <input
      type="file"
      id="imageUpload"
      accept="image/*"
      style="display: none"
    />
    <button id="uploadButton">Upload Image</button>
  </body>
  <script>
    document
      .getElementById("uploadButton")
      .addEventListener("click", function () {
        document.getElementById("imageUpload").click();
      });

    document
      .getElementById("imageUpload")
      .addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "100%";

            insertImageAtCaret(img);
          };
          reader.readAsDataURL(file);
        }
      });

    function insertImageAtCaret(img) {
      const editableDiv = document.getElementById("editableDiv");
      let sel, range;
      if (window.getSelection) {
        sel = window.getSelection();
        if (sel.getRangeAt && sel.rangeCount) {
          range = sel.getRangeAt(0);
          range.deleteContents();

          const frag = document.createDocumentFragment();
          frag.appendChild(img);

          const node = frag.firstChild;
          range.insertNode(frag);

          if (node) {
            range = range.cloneRange();
            range.setStartAfter(node);
            range.collapse(true);
            sel.removeAllRanges();
            sel.addRange(range);
          }
        }
      }
    }
  </script>
</html>
